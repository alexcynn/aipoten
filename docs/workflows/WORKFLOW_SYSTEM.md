# 시스템 간 연동 플로우

## 목차
1. [발달 체크 → 놀이영상 추천](#1-발달-체크--놀이영상-추천)
2. [발달 체크 → 치료사 매칭](#2-발달-체크--치료사-매칭)
3. [치료사 피드백 → 놀이영상 추천](#3-치료사-피드백--놀이영상-추천)
4. [정기 체크 알림 자동화](#4-정기-체크-알림-자동화)
5. [구독 관리 자동화](#5-구독-관리-자동화)
6. [데이터 분석 파이프라인](#6-데이터-분석-파이프라인)
7. [주요 예외 처리 플로우](#7-주요-예외-처리-플로우)
8. [플로우 최적화 포인트](#8-플로우-최적화-포인트)

---

## 1. 발달 체크 → 놀이영상 추천

```
사용자가 발달 체크 완료
  ↓
결과 분석 엔진 작동
  ↓
주의 필요 영역 식별
  ↓
해당 영역 집중 놀이영상 필터링
  ↓
아이 연령에 맞는 영상 선별
  ↓
추천 영상 리스트 생성
  ↓
발달 리포트에 표시
  ↓
푸시 알림: "OO이에게 딱 맞는 놀이영상을 확인하세요"
```

**추천 알고리즘:**
- 주의 영역 (40-59점): 집중 추천 10개
- 양호 영역 (60-79점): 유지 추천 5개
- 우수 영역 (80-100점): 심화 추천 5개
- 연령 필터: 아이 개월 수 ±3개월 범위

## 2. 발달 체크 → 치료사 매칭

```
발달 체크 결과 분석
  ↓
발달 지연 의심 영역 감지
  ↓
[조건: 특정 영역 점수가 하위 10%]
  ↓
적합한 치료 분야 식별
  - 언어 점수 낮음 → 언어치료
  - 대근육 점수 낮음 → 물리치료/작업치료
  ↓
사용자에게 권장 알림 표시
  "언어 발달을 위해 전문가 상담을 권장합니다"
  ↓
[치료사 찾기] 버튼 노출
  ↓
클릭 시 해당 분야 치료사 목록으로 자동 이동
  ↓
AI 추천 치료사 우선 표시
```

## 3. 치료사 피드백 → 놀이영상 추천

```
치료사가 상담 후 피드백 작성
  ↓
"가정에서 할 수 있는 활동" 항목에 키워드 입력
  예: "언어 자극", "소근육 발달"
  ↓
시스템이 키워드 매칭
  ↓
관련 놀이영상 자동 추천
  ↓
부모가 피드백 확인 시 추천 영상도 함께 표시
  ↓
[영상 바로보기] 버튼으로 즉시 시청 가능
```

## 4. 정기 체크 알림 자동화

```
사용자가 마지막 발달 체크 완료
  ↓
시스템에 완료 날짜 저장
  ↓
[3개월 후]
  ↓
정기 체크 알림 발송
  - 푸시 알림
  - 이메일 알림
  ↓
사용자가 알림 확인 및 체크 시작
  ↓
[미완료 시]
  ↓
1주일 후 리마인드 알림
  ↓
[계속 미완료 시]
  ↓
2주일 후 마지막 알림
```

## 5. 구독 관리 자동화

```
무료 사용자가 프리미엄 영상 클릭
  ↓
"프리미엄 구독이 필요합니다" 안내
  ↓
[구독하기] 버튼
  ↓
구독 플랜 선택
  - 월간 9,900원
  - 연간 99,000원 (2개월 무료)
  ↓
결제 수단 입력
  ↓
결제 완료
  ↓
즉시 프리미엄 기능 활성화
  ↓
[구독 만료 3일 전]
  ↓
갱신 안내 알림
  ↓
자동 갱신 또는 구독 취소
```

## 6. 데이터 분석 파이프라인

```
사용자 활동 데이터 수집
  - 발달 체크 결과
  - 영상 시청 기록
  - 매칭 신청 및 상담 이력
  ↓
데이터 웨어하우스 저장
  ↓
일간 배치 작업 실행
  ↓
분석 결과 생성
  - 사용자별 참여도 점수
  - 이탈 위험 사용자 식별
  - 인기 콘텐츠 순위
  ↓
결과를 관리자 대시보드에 반영
  ↓
마케팅 자동화 트리거
  - 이탈 위험 사용자에게 할인 쿠폰 발송
  - 인기 영상 소셜 미디어 홍보
```

## 7. 주요 예외 처리 플로우

### 7.1 발달 체크 중단 시

```
사용자가 발달 체크 중 이탈
  ↓
진행 상황 자동 저장 (마지막 응답까지)
  ↓
24시간 후 "이어서 하기" 알림 발송
  ↓
[재진입 시] 이어서 하기 옵션 제공
  ↓
[7일 이상 미완료] 데이터 삭제 또는 보관
```

### 7.2 매칭 무응답 시

```
부모가 치료사에게 매칭 신청
  ↓
치료사 48시간 이내 미응답
  ↓
치료사에게 리마인드 알림 발송
  ↓
[24시간 추가 대기]
  ↓
여전히 무응답
  ↓
부모에게 "다른 치료사 추천" 알림
  ↓
대체 치료사 목록 제공
  ↓
무응답 치료사 프로필에 응답률 반영
```

### 7.3 상담 취소 시

```
부모 또는 치료사가 상담 취소 요청
  ↓
[상담 24시간 전 취소]
  - 수수료 없이 취소 가능
  - 상대방에게 취소 알림
  ↓
[상담 24시간 이내 취소]
  - 취소 수수료 부과 안내
  - 사유 확인
  - 긴급 상황일 경우 예외 처리
  ↓
취소 확정
  ↓
환불 처리 (결제한 경우)
  ↓
양측에 취소 완료 알림
```

### 7.4 결제 실패 시

```
구독 자동 갱신 시도
  ↓
결제 실패 (카드 한도 초과, 만료 등)
  ↓
결제 실패 알림 발송
  "결제가 실패했습니다. 결제 수단을 확인해주세요"
  ↓
3일 유예 기간 제공
  ↓
재시도 실패 시
  ↓
구독 자동 해지
  ↓
프리미엄 기능 비활성화
  ↓
무료 플랜으로 자동 전환
```

## 8. 플로우 최적화 포인트

### 8.1 사용자 경험 최적화

1. **원클릭 액션**: 발달 리포트에서 놀이영상/치료사 매칭으로 바로 이동
2. **진행 상황 저장**: 모든 중요 작업에서 중간 저장 기능
3. **스마트 알림**: 사용자 활동 패턴 학습 후 최적 시간에 알림 발송
4. **빠른 재시작**: 중단했던 작업을 메인 화면에서 바로 재개

### 8.2 치료사 효율성 최적화

1. **일괄 처리**: 여러 매칭 요청을 한 번에 처리 가능
2. **캘린더 연동**: 구글 캘린더, 애플 캘린더 연동
3. **템플릿 기능**: 자주 쓰는 피드백 문구 템플릿 저장
4. **모바일 최적화**: 이동 중에도 요청 확인 및 승인 가능

### 8.3 관리자 운영 최적화

1. **자동 필터링**: 부적절한 콘텐츠 자동 감지
2. **배치 작업**: 대량의 데이터 처리 자동화
3. **이상 징후 알림**: 급격한 이탈률 증가, 서버 오류 등 즉시 알림
4. **A/B 테스트**: UI 변경사항 실험 및 효과 측정

---

## 관련 문서
- [부모 사용자 플로우](./WORKFLOW_PARENT.md)
- [치료사 플로우](./WORKFLOW_THERAPIST.md)
- [관리자 플로우](./WORKFLOW_ADMIN.md)
- [메인 워크플로우 인덱스](../WORKFLOW.md)
